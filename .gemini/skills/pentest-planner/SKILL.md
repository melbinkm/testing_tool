# Pentest Planner Skill

## Purpose

Generate structured test hypotheses in JSON format based on discovered attack surface. Analyzes endpoints, identifies potential vulnerabilities, prioritizes by value and complexity, and registers hypotheses in the world model.

## Capabilities

1. **Attack Surface Analysis**
   - Analyze discovered endpoints and parameters
   - Identify authentication patterns
   - Map data flows and trust boundaries
   - Detect potential injection points

2. **Hypothesis Generation**
   - Generate structured test hypotheses
   - Categorize by vulnerability class (OWASP Top 10, CWE)
   - Estimate confidence and complexity
   - Define required test steps

3. **Prioritization**
   - Score hypotheses by potential impact
   - Consider complexity and effort required
   - Balance quick wins vs deep testing
   - Account for scope constraints

4. **World Model Integration**
   - Register hypotheses for tracking
   - Link to discovered endpoints
   - Track hypothesis lifecycle
   - Support iterative refinement

## Input

The skill expects context about:
- Discovered endpoints and their parameters
- Authentication/authorization patterns observed
- Any initial reconnaissance findings
- Scope constraints and priorities

## Output Format

Hypotheses are generated in JSON format:

```json
{
  "hypothesis_id": "H-{timestamp}-{random}",
  "title": "Potential IDOR in User Profile Endpoint",
  "vulnerability_class": "BOLA/IDOR",
  "cwe_id": "CWE-639",
  "owasp_category": "A01:2021 - Broken Access Control",
  "target": {
    "endpoint": "/api/v1/users/{id}/profile",
    "method": "GET",
    "parameters": ["id"]
  },
  "description": "The user profile endpoint accepts a numeric user ID. Testing if authorization properly validates the requesting user owns the requested profile.",
  "test_steps": [
    {
      "step": 1,
      "action": "Authenticate as User A",
      "tool": "auth-tester-mcp"
    },
    {
      "step": 2,
      "action": "Request User B's profile using User A's session",
      "tool": "http-client-mcp"
    },
    {
      "step": 3,
      "action": "Compare response to expected (403 Forbidden)",
      "tool": "validator-mcp"
    }
  ],
  "priority": {
    "impact": "high",
    "likelihood": "medium",
    "effort": "low",
    "overall_score": 8.5
  },
  "prerequisites": [
    "Valid authentication tokens for multiple users",
    "Target endpoint discovered and in scope"
  ],
  "success_criteria": {
    "positive_indicator": "Access to other user's data with status 200",
    "negative_indicator": "Status 401/403 when accessing other's data"
  },
  "status": "proposed",
  "created_at": "2024-01-15T10:30:00Z"
}
```

## Prioritization Algorithm

Hypotheses are scored using:

```
overall_score = (impact_weight * impact_score) +
                (likelihood_weight * likelihood_score) -
                (effort_weight * effort_score)
```

Where:
- **impact_weight**: 0.4 (higher for critical vulnerabilities)
- **likelihood_weight**: 0.4 (based on patterns observed)
- **effort_weight**: 0.2 (lower effort = higher score)

Impact levels:
- Critical: 10 (RCE, full DB access)
- High: 8 (auth bypass, data exposure)
- Medium: 5 (information disclosure)
- Low: 2 (minor issues)

## Workflow

1. **Receive Context**
   - Accept endpoint inventory from reconnaissance
   - Parse any existing findings or observations

2. **Analyze Attack Surface**
   - Identify authentication mechanisms
   - Map parameter types and injection points
   - Note unusual patterns or behaviors

3. **Generate Hypotheses**
   - Create hypothesis for each potential vulnerability
   - Apply templates for common vulnerability classes
   - Customize based on observed patterns

4. **Prioritize**
   - Score each hypothesis
   - Sort by overall score descending
   - Group by effort for phased testing

5. **Register in World Model**
   - Use world-model-mcp to store hypotheses
   - Create relationships to endpoints
   - Set initial status to "proposed"

## Vulnerability Templates

The skill includes templates for common vulnerabilities:

### BOLA/IDOR
- Direct object reference manipulation
- Horizontal privilege escalation
- Resource enumeration

### Injection
- SQL injection (error-based, blind, time-based)
- NoSQL injection
- Command injection
- Template injection (SSTI)

### Authentication
- Session fixation
- Token prediction
- Password reset flaws
- MFA bypass

### Authorization
- Vertical privilege escalation
- Function-level access control
- Parameter tampering

### Data Exposure
- Sensitive data in responses
- Verbose error messages
- Debug information disclosure

## Integration Points

- **http-client-mcp**: Execute HTTP requests for tests
- **auth-tester-mcp**: Differential testing with identities
- **validator-mcp**: Validate findings with reproduction
- **evidence-mcp**: Record evidence bundles
- **world-model-mcp**: Store hypotheses and track state

## Usage Example

```
User: Analyze the discovered endpoints and generate test hypotheses

AI (using pentest-planner skill):
1. Analyzing 15 discovered endpoints...
2. Identified 3 authentication patterns
3. Found 8 potential injection points
4. Detected 2 IDOR-susceptible endpoints

Generated 12 hypotheses:
- H-001: IDOR in /api/users/{id} (Score: 8.5, Priority: HIGH)
- H-002: SQL Injection in /api/search?q= (Score: 7.2, Priority: HIGH)
- H-003: Missing auth on /api/admin/stats (Score: 9.0, Priority: CRITICAL)
...

Registered in world model. Ready to begin testing.
Recommend starting with H-003 (highest impact, low effort).
```

## Best Practices

1. **Scope Awareness**: Always verify targets are in scope before generating hypotheses
2. **Iterative Refinement**: Update hypotheses based on test results
3. **Evidence Linking**: Connect hypotheses to supporting evidence
4. **Status Tracking**: Maintain accurate hypothesis lifecycle status
5. **Deduplication**: Merge similar hypotheses to avoid redundant testing
