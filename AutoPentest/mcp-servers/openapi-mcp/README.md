# OpenAPI MCP Server

An MCP (Model Context Protocol) server for parsing and exploring OpenAPI/Swagger specifications. This server enables AI agents to enumerate API endpoints and generate sample requests for penetration testing purposes.

## Features

- Parse OpenAPI 3.0 specifications from files or URLs
- Support for both JSON and YAML formats
- List and filter API endpoints by method, tag, or path
- Get detailed schema information for endpoints
- Generate sample HTTP requests based on endpoint schemas
- Extract security scheme information

## Prerequisites

- Node.js >= 20.0.0
- npm or yarn

## Installation

```bash
cd mcp-servers/openapi-mcp
npm install
```

## Build

```bash
npm run build
```

## Usage

### Start the MCP Server

```bash
npm start
```

The server communicates via stdio and is designed to be integrated with MCP-compatible clients.

### MCP Client Configuration

Add the following to your MCP client configuration:

```json
{
  "mcpServers": {
    "openapi": {
      "command": "node",
      "args": ["/path/to/openapi-mcp/dist/server.js"]
    }
  }
}
```

## Available Tools

### openapi_ingest

Load and parse an OpenAPI specification from a file path or URL.

**Parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `source` | string | Yes | File path or URL to the OpenAPI spec (YAML or JSON) |

**Example:**
```json
{
  "source": "/path/to/openapi.yaml"
}
```

**Response:**
```json
{
  "success": true,
  "title": "Pet Store API",
  "version": "1.0.0",
  "base_url": "https://api.petstore.com",
  "endpoint_count": 15,
  "security_schemes": ["bearerAuth", "apiKey"]
}
```

### openapi_list_endpoints

List all endpoints from the loaded OpenAPI spec with optional filtering.

**Parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `method_filter` | string | No | Filter by HTTP method (GET, POST, PUT, DELETE, etc.) |
| `tag_filter` | string | No | Filter by tag |
| `path_contains` | string | No | Filter paths containing this string |

**Example:**
```json
{
  "method_filter": "POST",
  "tag_filter": "users"
}
```

**Response:**
```json
{
  "count": 2,
  "endpoints": [
    {
      "endpoint_id": "POST--users",
      "method": "POST",
      "path": "/users",
      "summary": "Create a new user",
      "tags": ["users"],
      "requires_auth": true
    }
  ]
}
```

### openapi_get_schema

Get detailed schema information for a specific endpoint.

**Parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `endpoint_id` | string | No | Endpoint ID from openapi_list_endpoints |
| `method` | string | No | HTTP method (alternative to endpoint_id) |
| `path` | string | No | Path (alternative to endpoint_id) |

Use either `endpoint_id` alone, or `method` + `path` together.

**Example (by endpoint_id):**
```json
{
  "endpoint_id": "POST--users"
}
```

**Example (by method + path):**
```json
{
  "method": "POST",
  "path": "/users"
}
```

**Response:**
```json
{
  "endpoint_id": "POST--users",
  "method": "POST",
  "path": "/users",
  "operation_id": "createUser",
  "summary": "Create a new user",
  "tags": ["users"],
  "parameters": [],
  "request_body": {
    "required": true,
    "content_types": ["application/json"],
    "schema": {
      "type": "object",
      "properties": {
        "name": { "type": "string" },
        "email": { "type": "string", "format": "email" }
      }
    }
  },
  "responses": {
    "201": {
      "status_code": "201",
      "description": "User created"
    }
  },
  "security": ["bearerAuth"]
}
```

### openapi_generate_request

Generate a sample HTTP request for an endpoint based on its schema.

**Parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `endpoint_id` | string | Yes | Endpoint ID from openapi_list_endpoints |
| `base_url` | string | No | Override base URL from spec (optional) |

**Example:**
```json
{
  "endpoint_id": "POST--users",
  "base_url": "https://localhost:8080"
}
```

**Response:**
```json
{
  "endpoint_id": "POST--users",
  "sample_request": {
    "method": "POST",
    "url": "https://localhost:8080/users",
    "headers": {
      "Content-Type": "application/json"
    },
    "body": "{\"name\":\"example\",\"email\":\"test@example.com\"}"
  }
}
```

## Testing

Run the test suite:

```bash
npm test
```

Run tests with coverage:

```bash
npm test -- --coverage
```

Type checking:

```bash
npm run typecheck
```

## Supported OpenAPI Features

- OpenAPI 3.0.x specifications
- JSON and YAML formats
- Path, query, header, and cookie parameters
- Request body schemas
- Response schemas
- Security schemes (API key, Bearer token, OAuth2)
- Tags and operation IDs

## Sample Value Generation

The server generates sample values based on schema types:

| Schema Type | Format | Sample Value |
|-------------|--------|--------------|
| integer | - | `1` |
| number | - | `1.0` |
| boolean | - | `true` |
| string | - | `example` |
| string | uuid | `550e8400-e29b-41d4-a716-446655440000` |
| string | email | `test@example.com` |
| string | date | `2024-01-01` |
| string | date-time | `2024-01-01T00:00:00Z` |

Fields containing "id" in the name will generate `123` as a sample value.

## Error Handling

All tools return consistent error responses:

```json
{
  "error": "Error message description"
}
```

Common errors:
- "No spec loaded. Use openapi_ingest first." - Call openapi_ingest before using other tools
- "Endpoint not found" - The specified endpoint doesn't exist
- "Failed to fetch spec: 404 Not Found" - URL returned an error

## License

MIT
