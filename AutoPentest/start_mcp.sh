#!/usr/bin/env bash
set -euo pipefail

CONTAINER="autopentest_backend"
MCP_SCRIPT="/app/mcp/autopentest_server.py"

# Verify container is running
if ! docker inspect -f '{{.State.Running}}' "$CONTAINER" 2>/dev/null | grep -q true; then
    echo "[ERROR] Container '$CONTAINER' is not running. Start it with: docker compose up -d" >&2
    exit 1
fi

# Launch MCP server inside the container via stdin/stdout
# -i keeps stdin open (required for MCP stdio protocol)
# -u for unbuffered Python output (important for stdio protocol)
# stderr goes to log file on host to avoid polluting MCP protocol
exec docker exec -i "$CONTAINER" python -u "$MCP_SCRIPT" 2>/tmp/autopentest_mcp.log
