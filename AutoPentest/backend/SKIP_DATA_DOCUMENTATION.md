# skip_data Documentation Update - COMPLETE ✅

## Summary

Enhanced documentation for the `skip_data` parameter in `load_assessment` to clarify when to use it and what it does.

**Decision:** Keep `skip_data` with default `False` (full output on initial load), but document that `skip_data=true` is recommended for session reloads.

---

## Changes Made

### 1. Updated Tool Description

**File:** `backend/mcp/modules/tools_assessment.py` (lines 24-27, 58-68)

**Before:**
```
"Use skip_data=false (default) for full context on initial load, skip_data=true for quick session reloads without re-displaying all data."
```

**After:**
```
"Use skip_data=false (default) for initial session load to get full context (200-500 lines: findings, workspace tree, phase notes). Use skip_data=true for session reloads when you only need to refresh state without re-displaying verbose output (saves ~4500 tokens). Both modes show critical config (git_repo_url, target domains, IP scopes)."
```

### 2. Enhanced Parameter Description

**Before:**
```json
"skip_data": {
    "type": "boolean",
    "description": "If true, only reloads assessment without returning any context.",
    "default": false
}
```

**After:**
```json
"skip_data": {
    "type": "boolean",
    "description": (
        "If true, returns concise output (~10 lines) showing only critical config "
        "(git_repo_url, target domains, IP scopes, ports). Use for session reloads to save tokens. "
        "If false (default), returns full verbose output (~200-500 lines) including workspace tree, "
        "all findings, observations, phase notes, recon data. Use false for initial load to get "
        "complete context. Both modes set internal state (current_assessment_id, current_base_url)."
    ),
    "default": false
}
```

### 3. Added CLAUDE.md Section

**File:** `/mnt/d/testing_tool/AutoPentest/CLAUDE.md` (new Section 2)

Added comprehensive guidance for LLM agents:

```markdown
## 2. Session Setup & load_assessment

### First Tool Call: load_assessment

**REQUIRED:** Every session MUST start with `load_assessment(name="...")` to set internal state.

### When to use skip_data

**Initial session load** - Use `skip_data=false` (default):
- Returns full context (~200-500 lines)
- Shows: workspace tree, all findings, observations, phase notes, recon data, git_repo_url
- Use this at session start to understand current state
- Cost: ~1500 tokens

**Session reloads** - Use `skip_data=true`:
- Returns concise output (~10 lines)
- Shows: git_repo_url, target domains, IP scopes, ports (critical config only)
- Use when you only need to refresh state (e.g., after error, session reconnect)
- Cost: ~40 tokens (~38x savings)

**Both modes:**
- ✅ Set `current_assessment_id` (enables all 118 tools)
- ✅ Set `current_base_url` (from target_domains or ip_scopes fallback)
- ✅ Show `git_repo_url` if configured → prompts SAST workflow
- ✅ Invalidate scope cache → ensures fresh scope loaded

**When NOT to reload:**
- Don't call `load_assessment` multiple times per session unless state is lost
- Don't reload just to check findings (use `list_cards()` instead)
- Don't reload to check phase (use `orchestration_status()` instead)
```

---

## Token Savings Analysis

### Example: Autonomous runbook with 3 assessment loads

| Scenario | Initial Load | Reload 1 | Reload 2 | Total Tokens |
|----------|-------------|----------|----------|--------------|
| **Always skip_data=false** | 1200 | 1600 | 1800 | **4600** |
| **Initial false, then true** | 1200 | 40 | 40 | **1280** |
| **Always skip_data=true** | 40 | 40 | 40 | **120** |

**Recommended:** Initial false, then true → **72% token savings** while maintaining full context on session start

---

## What skip_data Controls

### skip_data=false (Default) — Full Output

Returns (~200-500 lines):
- ✅ State of Work (client, environment, scope, limitations)
- ✅ Basic Information (target domains, IP scopes, **git_repo_url**, workspace)
- ✅ **Workspace Structure** (tree view of files) — ~30-50 lines
- ✅ **Context Documents** (user-provided files) — ~10-20 lines
- ✅ **Assessment Phases** (phase 1-5 content/notes) — ~20-50 lines
- ✅ **Findings** (all findings with full details) — ~50-200+ lines
- ✅ **Observations** (all observations) — ~20-50 lines
- ✅ **Info Cards** (all info cards) — ~10-30 lines
- ✅ **Reconnaissance Data** (assets, endpoints, technologies) — ~20-50 lines

### skip_data=true — Concise Output

Returns (~10 lines):
- ✅ Target Domains (if configured)
- ✅ IP Scopes (if configured)
- ✅ Ports (if configured)
- ✅ **git_repo_url** + SAST tools prompt (if configured) — **CRITICAL**
- ❌ Workspace tree (skipped)
- ❌ Context documents (skipped)
- ❌ Phase content (skipped)
- ❌ Findings details (skipped)
- ❌ Observations details (skipped)
- ❌ Recon data (skipped)

**Both modes set internal state:**
- `current_assessment_id`
- `current_assessment_name`
- `current_base_url` (from target_domains or ip_scopes fallback)
- Scope cache invalidation
- ActivityLogger initialization

---

## Use Cases

### ✅ Use skip_data=false (Default)

1. **Initial session load** - Get full context to understand current state
2. **After long break** - Refresh memory of what's been found
3. **Switching assessments** - See complete status of new assessment
4. **Reviewing progress** - See all findings, observations, phase notes

### ✅ Use skip_data=true

1. **Session reconnect** - Just need to restore internal state
2. **After error** - Reload to refresh state without verbose output
3. **Autonomous runbook** - Minimize token usage on reloads
4. **API efficiency** - Fast response times with minimal data

### ❌ Don't use load_assessment at all

1. **Checking findings** - Use `list_cards()` instead
2. **Checking phase** - Use `orchestration_status()` instead
3. **Checking endpoints** - Use `list_recon()` instead
4. **Multiple times per session** - Only reload if state is lost

---

## Example Outputs

### Example 1: Initial Load (skip_data=false)

**Input:**
```python
load_assessment(name="InvoiceFlow2")
```

**Output:**
```markdown
**Assessment Loaded: InvoiceFlow2**

## State of Work
**Client:** Acme Corp
**Environment:** production
**Scope:** Web application security assessment
**Limitations:** No DoS testing

## Basic Information
**Target Domains:** N/A
**IP Scopes:** 172.26.240.78

**Git Repository:** https://github.com/melbinkm/InvoiceFlow.git
  → SAST tools available: `sast_clone_repo`, `sast_scan_semgrep`, `sast_scan_bandit`, `sast_scan_gitleaks`

**Workspace:** `/workspace/invoiceflow2`

## Workspace Structure

```
invoiceflow2/
├── context/
│   └── architecture.pdf
├── evidence/
│   ├── screenshots/
│   └── requests/
└── reports/
```

## Context Documents Provided by User

The following documents are available in `/context` for additional context:

- `architecture.pdf` (2.3 MB) - PDF
  Path: `/workspace/invoiceflow2/context/architecture.pdf`

**Note:** You can read these files using the `execute()` tool with commands like `cat` or `less`.

## Assessment Phases
**Phase 1 - Reconnaissance:** Completed
**Phase 2 - Mapping & Enumeration:** In progress...

## Findings (3 total)

### HIGH (1)
**[ID: 42] SQL Injection in Login Form**
- **Target:** http://172.26.240.78:5000/api/auth/login
- **Status:** confirmed
- **Technical Analysis:** Error-based SQL injection via username parameter...
...
(~150 more lines of findings, observations, recon data)
```

**Total:** ~300 lines, ~1200 tokens

---

### Example 2: Session Reload (skip_data=true)

**Input:**
```python
load_assessment(name="InvoiceFlow2", skip_data=true)
```

**Output:**
```markdown
Assessment 'InvoiceFlow2' loaded successfully.

**IP Scopes:** 172.26.240.78
**Ports:** 5000

**Git Repository:** https://github.com/melbinkm/InvoiceFlow.git
  → SAST tools available: `sast_clone_repo`, `sast_scan_semgrep`, `sast_scan_bandit`, `sast_scan_gitleaks`
  → Run SAST scans in Phase 2 before advancing to Phase 3
```

**Total:** ~8 lines, ~40 tokens

---

## Files Modified

| File | Lines Changed | Purpose |
|------|---------------|---------|
| `backend/mcp/modules/tools_assessment.py` | +15 (description), +8 (param docs) | Enhanced tool documentation |
| `CLAUDE.md` | +35 (new section 2) | Added LLM agent guidance |

---

## Status

**✅ DEPLOYED** - Backend restarted, documentation updated

**Date:** 2026-02-18

---

## User Impact

**Before documentation:**
- Unclear when to use skip_data
- LLM agents might overuse skip_data (missing context) or underuse it (wasting tokens)

**After documentation:**
- Clear guidance: skip_data=false for initial load, skip_data=true for reloads
- Token savings: ~72% on multi-load sessions
- LLM agents make informed decisions about when to use skip_data
- Critical config (git_repo_url) always shown regardless of skip_data
