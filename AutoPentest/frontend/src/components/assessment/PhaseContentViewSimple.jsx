import React, { useState } from 'react';
import { AlertTriangle, Info, Eye } from '../icons';
import EditableField from '../common/EditableField';
import MarkdownRenderer from '../common/MarkdownRenderer';
import apiClient from '../../services/api';

const PHASE_NAMES = {
  1: 'Reconnaissance',
  2: 'Mapping & Enumeration',
  3: 'Vulnerability Assessment',
  4: 'Exploitation',
  5: 'Post-Exploitation & Reporting',
};

const PhaseContentViewSimple = ({ phaseNumber, assessmentId, section, onUpdate, cards, commands }) => {
  const [isEditing, setIsEditing] = useState(false);

  const updateContent = async (newContent) => {
    try {
      await apiClient.post(`/assessments/${assessmentId}/sections`, {
        section_type: `phase_${phaseNumber}`,
        section_number: phaseNumber,
        title: PHASE_NAMES[phaseNumber],
        content: newContent,
      });
      onUpdate();
    } catch (error) {
      console.error('Failed to update phase content:', error);
    }
  };

  const getSeverityColor = (severity) => {
    switch (severity) {
      case 'CRITICAL': return 'text-red-600 dark:text-red-400';
      case 'HIGH': return 'text-orange-600 dark:text-orange-400';
      case 'MEDIUM': return 'text-yellow-600 dark:text-yellow-400';
      case 'LOW': return 'text-blue-600 dark:text-blue-400';
      default: return 'text-neutral-600 dark:text-neutral-400';
    }
  };

  return (
    <div className="space-y-8">
      {/* Header de la Phase */}
      <div className="flex items-center justify-between">
        <div>
          <h3 className="text-xl font-semibold text-neutral-900 dark:text-neutral-100">
            Phase {phaseNumber} - {PHASE_NAMES[phaseNumber]}
          </h3>
          <p className="text-sm text-neutral-500 dark:text-neutral-400 mt-1">
            {cards.length} cards
          </p>
        </div>
        <button
          onClick={() => setIsEditing(!isEditing)}
          className="text-sm text-neutral-500 dark:text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 px-3 py-1 rounded hover:bg-neutral-100 dark:hover:bg-neutral-700 transition-colors"
        >
          {isEditing ? 'Done' : 'Edit Notes'}
        </button>
      </div>

      {/* SÃ©parateur */}
      <div className="border-t border-gray-200 dark:border-neutral-700"></div>

      {/* Notes de la Phase - Sans cadre */}
      <div>
        <h4 className="text-lg font-medium text-neutral-800 dark:text-neutral-200 mb-4">Notes</h4>
        {isEditing ? (
          <EditableField
            value={section?.content || ''}
            onSave={(newContent) => {
              updateContent(newContent);
              setIsEditing(false);
            }}
            multiline
            placeholder="Click to add notes for this phase..."
            className="text-neutral-700 dark:text-neutral-300 text-base min-h-[200px] block w-full p-4 border border-neutral-300 dark:border-neutral-600 rounded-lg bg-white dark:bg-neutral-900 leading-relaxed focus:border-primary-500 focus:ring-1 focus:ring-primary-500"
          />
        ) : (
          <div className="min-h-[120px]">
            {section?.content ? (
              <div className="prose-custom">
                <MarkdownRenderer content={section.content} />
              </div>
            ) : (
              <div className="text-neutral-500 dark:text-neutral-400 italic py-8">
                No notes for this phase yet. Click "Edit Notes" to add content.
              </div>
            )}
          </div>
        )}
      </div>


    </div>
  );
};

export default PhaseContentViewSimple;
