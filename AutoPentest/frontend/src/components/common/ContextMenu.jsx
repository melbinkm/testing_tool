import { Dropdown } from 'antd';
import { Folder, Copy, Trash2, Share, FileText } from 'lucide-react';

const ContextMenu = ({
  isOpen,
  onClose,
  position = { x: 0, y: 0 },
  onMoveToFolder,
  onDuplicate,
  onDelete,
  onExport,
  onShare,
  folders = [],
  assessment = null
}) => {
  if (!isOpen) return null;

  const customFolders = folders.filter(folder => !folder.is_system);

  const folderItems = customFolders.length > 0 ? [
    {
      key: 'move-group',
      type: 'group',
      label: 'Move to Folder',
      children: [
        {
          key: 'no-folder',
          icon: <Folder className="w-4 h-4" />,
          label: 'No Folder',
          onClick: () => { onMoveToFolder(null); onClose(); },
        },
        ...customFolders.map(folder => ({
          key: `folder-${folder.id}`,
          icon: <Folder className="w-4 h-4" style={{ color: folder.color }} />,
          label: folder.name,
          onClick: () => { onMoveToFolder(folder.id); onClose(); },
        })),
      ],
    },
    { type: 'divider' },
  ] : [];

  const menuItems = [
    ...folderItems,
    {
      key: 'duplicate',
      icon: <Copy className="w-4 h-4" />,
      label: 'Duplicate Assessment',
      onClick: () => { onDuplicate(); onClose(); },
    },
    {
      key: 'delete',
      icon: <Trash2 className="w-4 h-4" />,
      label: 'Delete Assessment',
      danger: true,
      onClick: () => { onDelete(); onClose(); },
    },
    { type: 'divider' },
    {
      key: 'export',
      icon: <FileText className="w-4 h-4" />,
      label: 'Export Report',
      onClick: () => { onExport(); onClose(); },
    },
    {
      key: 'share',
      icon: <Share className="w-4 h-4" />,
      label: 'Share Assessment',
      onClick: () => { onShare(); onClose(); },
    },
  ];

  return (
    <>
      <div className="fixed inset-0 z-40" onClick={onClose} />
      <Dropdown
        menu={{ items: menuItems }}
        open={true}
        onOpenChange={(open) => { if (!open) onClose(); }}
        trigger={[]}
      >
        <div
          className="fixed z-50"
          style={{ left: position.x, top: position.y, width: 1, height: 1 }}
        />
      </Dropdown>
    </>
  );
};

export default ContextMenu;
