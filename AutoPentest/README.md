<h1 align="center">AutoPentest</h1>

<p align="center">
  <strong>Unified MCP Server for AI-Powered Penetration Testing</strong>
</p>

<p align="center">
  <a href="#quick-start">Quick Start</a> &bull;
  <a href="#architecture">Architecture</a> &bull;
  <a href="#mcp-tools">MCP Tools</a> &bull;
  <a href="#docker-setup">Docker Setup</a>
</p>

<p align="center">
  <img src="https://img.shields.io/badge/License-AGPL_v3-blue" alt="License">
  <img src="https://img.shields.io/badge/MCP-Compatible-green" alt="MCP">
  <img src="https://img.shields.io/badge/Docker-Kali-orange" alt="Kali">
  <img src="https://img.shields.io/badge/Tools-74-purple" alt="Tools">
  <img src="https://img.shields.io/badge/Version-1.0.0--alpha-red" alt="Version">
</p>

---

## What is AutoPentest?

**AutoPentest** is a single unified MCP server that gives AI assistants full penetration testing capabilities. It merges scope management, HTTP testing, fuzzing, vulnerability scanning, browser automation, evidence collection, and more into **74 tools** that share state.

- **Kali Linux container** with 400+ security tools (nmap, sqlmap, ffuf, nuclei...)
- **Single MCP server** with 74 tools across 16 modules -- one connection, full capabilities
- **Scope guard** ensuring all testing stays within authorized boundaries
- **Web dashboard** to track assessments, findings, and evidence
- **Browser automation** with Playwright for web app testing and XSS detection

---

## Quick Start

### Prerequisites

- **Docker Desktop** (or Docker Engine + Compose)
- **Python 3.10+** for the MCP server
- **An AI Client** with MCP support (Claude Code, Claude Desktop, Gemini CLI, etc.)

```bash
# Clone
git clone <repo-url>
cd AutoPentest

# Start the full stack (postgres, backend, kali, frontend)
docker-compose up -d

# Or just start the MCP server standalone
./start_mcp.sh
```

### Connect Your AI Client

Add to your MCP client configuration:

```json
{
  "mcpServers": {
    "autopentest": {
      "command": "/bin/bash",
      "args": ["/absolute/path/to/AutoPentest/start_mcp.sh"]
    }
  }
}
```

---

## Architecture

AutoPentest consolidates what was previously 10 separate TypeScript MCP servers + 1 Python MCP into a single unified Python server.

```
AutoPentest/
├── backend/
│   ├── mcp/
│   │   ├── autopentest_server.py      # Entry point (registry-based dispatch)
│   │   └── modules/
│   │       ├── service.py             # AutoPentestService (container mgmt)
│   │       ├── resources.py           # MCP resources
│   │       ├── tools_assessment.py    # 2 tools: load/update assessments
│   │       ├── tools_cards.py         # 4 tools: finding cards CRUD
│   │       ├── tools_recon.py         # 2 tools: recon data tracking
│   │       ├── tools_execution.py     # 1 tool: command execution in Kali
│   │       ├── tools_scanning.py      # 5 tools: nmap, gobuster, ssl, etc.
│   │       ├── tools_credentials.py   # 2 tools: credential management
│   │       ├── tools_scope.py         # 6 tools: scope validation & budget
│   │       ├── tools_http.py          # 3 tools: rate-limited HTTP client
│   │       ├── tools_fuzzer.py        # 3 tools: API parameter fuzzing
│   │       ├── tools_nuclei.py        # 3 tools: nuclei scanner integration
│   │       ├── tools_openapi.py       # 6 tools: OpenAPI spec analysis
│   │       ├── tools_validator.py     # 4 tools: finding validation
│   │       ├── tools_evidence.py      # 4 tools: evidence bundling & export
│   │       ├── tools_auth_tester.py   # 3 tools: BOLA/IDOR detection
│   │       ├── tools_world_model.py   # 9 tools: SQLite knowledge graph
│   │       ├── tools_browser.py       # 17 tools: Playwright browser automation
│   │       └── lib/                   # 27 supporting library modules
│   ├── api/                           # REST API endpoints
│   ├── models/                        # Database models
│   ├── services/                      # Business logic
│   └── config.py                      # Settings (Pydantic)
├── frontend/                          # React dashboard
├── docker-compose.yml                 # Full stack orchestration
├── Dockerfile.kali                    # Kali Linux container
└── start_mcp.sh                       # MCP server launcher
```

---

## MCP Tools

### 74 tools across 16 modules:

| Module | Tools | Description |
|--------|-------|-------------|
| **Assessment** (2) | `load_assessment`, `update_phase` | Load engagements, track methodology phases |
| **Cards** (4) | `add_card`, `list_cards`, `update_card`, `delete_card` | Finding/observation management |
| **Recon** (2) | `add_recon_data`, `list_recon` | Asset and discovery tracking |
| **Execution** (1) | `execute` | Run commands in Kali container |
| **Scanning** (5) | `scan`, `subdomain_enum`, `ssl_analysis`, `tech_detection`, `tool_help` | Automated scanning with output parsing |
| **Credentials** (2) | `credentials_add`, `credentials_list` | Credential storage |
| **Scope** (6) | `scope_validate_target`, `scope_get_allowlist`, `scope_get_constraints`, `scope_check_budget`, `scope_record_request`, `scope_get_identities` | Target validation, rate limiting, budget tracking |
| **HTTP** (3) | `http_send`, `http_send_batch`, `http_get_stats` | Rate-limited HTTP with correlation headers and proxy support |
| **Fuzzer** (3) | `fuzz_endpoint`, `fuzz_parameter`, `fuzz_list_payloads` | Schema-aware API fuzzing with anomaly detection |
| **Nuclei** (3) | `nuclei_scan_single`, `nuclei_scan_template`, `nuclei_list_templates` | Nuclei vulnerability scanner integration |
| **OpenAPI** (6) | `openapi_parse`, `openapi_list_specs`, `openapi_list_endpoints`, `openapi_get_endpoint`, `openapi_get_schemas`, `openapi_remove` | OpenAPI/Swagger spec analysis |
| **Validator** (4) | `validate_repro`, `validate_negative_control`, `validate_cross_identity`, `validate_promote` | Finding validation with confidence scoring |
| **Evidence** (4) | `evidence_bundle`, `evidence_add_artifact`, `evidence_export`, `evidence_generate_report` | Evidence collection, redaction, and export |
| **Auth Tester** (3) | `auth_get_identities`, `auth_diff_test`, `auth_replay_with_identity` | BOLA/IDOR differential testing |
| **World Model** (9) | `wm_add_asset`, `wm_add_endpoint`, `wm_add_identity`, `wm_add_hypothesis`, `wm_update_hypothesis`, `wm_add_finding`, `wm_update_finding`, `wm_add_observation`, `wm_query` | SQLite knowledge graph for tracking discoveries |
| **Browser** (15) | `browser_session_create`, `browser_navigate`, `browser_discover_forms`, `browser_test_xss`, `browser_screenshot`, `browser_click`, `browser_fill`, `browser_eval`, `browser_get_elements`, `browser_type`, + 5 more | Playwright-based browser automation with XSS detection |

---

## Docker Setup

The `docker-compose.yml` provides four services:

| Service | Container | Purpose |
|---------|-----------|---------|
| **postgres** | `autopentest_postgres` | PostgreSQL 16 for assessment data |
| **backend** | `autopentest_backend` | FastAPI REST API |
| **kali** | `kali-autopentest` | Kali Linux with 400+ security tools |
| **frontend** | `autopentest_frontend` | React web dashboard |

```bash
# Start everything
docker-compose up -d

# Check status
docker-compose ps

# View backend logs
docker-compose logs -f backend

# Access Kali container
docker exec -it kali-autopentest bash
```

---

## Configuration

Copy `.env.example` to `.env` and configure:

```bash
cp backend/.env.example backend/.env
```

Key settings:
- `DEFAULT_CONTAINER_NAME` - Kali container name (default: `kali-autopentest`)
- `SCOPE_FILE` - Path to engagement scope YAML (for scope validation)
- `BACKEND_API_URL` - Backend API URL for MCP server

---

## Dependencies

### Python (backend/requirements.txt)
- `fastapi`, `uvicorn`, `sqlalchemy`, `asyncpg` - Web framework and database
- `mcp>=1.0.0` - Model Context Protocol SDK
- `httpx` - Async HTTP client
- `pydantic` - Data validation
- `pyyaml` - Scope file parsing
- `playwright` - Browser automation
- `jinja2` - Report templates
- `aiosqlite` - World model database
- `google-generativeai` - Optional AI browser features

---

## Security Notes

- **Scope enforcement**: All targets are validated against the engagement scope before any action
- **Budget tracking**: Rate limits and request budgets prevent runaway testing
- **Correlation IDs**: Every request is tagged with engagement, action, and request IDs for audit trails
- **Evidence redaction**: Sensitive data (API keys, passwords, JWTs) is automatically redacted in exports
- **Approval policy**: High-risk actions can require human approval

---

## License

**AGPL v3** - Free and open source.

Based on [AIDA](https://github.com/Vasco0x4/AIDA) by Vasco0x4.
